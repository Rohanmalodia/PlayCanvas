var Follow=pc.createScript("follow");Follow.attributes.add("target",{type:"entity",title:"Target",description:"The Entity to follow"}),Follow.attributes.add("distance",{type:"number",default:4,title:"Distance",description:"How far from the Entity should the follower be"}),Follow.prototype.initialize=function(){this.vec=new pc.Vec3},Follow.prototype.update=function(t){if(this.target){var e=this.target.getPosition();e.x+=.75*this.distance,e.y+=1*this.distance,e.z+=.75*this.distance,this.vec.lerp(this.vec,e,.1),this.entity.setPosition(this.vec)}};var Movement=pc.createScript("movement");Movement.attributes.add("speed",{type:"number",default:.1,min:.05,max:.5,precision:2,description:"Controls the movement speed"}),Movement.prototype.initialize=function(){this.force=new pc.Vec3},Movement.prototype.update=function(e){var t=0,s=0;if(this.app.keyboard.isPressed(pc.KEY_LEFT)&&(t=-this.speed),this.app.keyboard.isPressed(pc.KEY_RIGHT)&&(t+=this.speed),this.app.keyboard.isPressed(pc.KEY_UP)&&(s=-this.speed),this.app.keyboard.isPressed(pc.KEY_DOWN)&&(s+=this.speed),this.force.x=t,this.force.z=s,this.force.length()){var i=Math.cos(.25*-Math.PI),o=Math.sin(.25*-Math.PI);this.force.set(this.force.x*i-this.force.z*o,0,this.force.z*i+this.force.x*o),this.force.length()>this.speed&&this.force.normalize().scale(this.speed)}this.entity.rigidbody.applyImpulse(this.force)};var Teleportable=pc.createScript("teleportable");Teleportable.prototype.initialize=function(){this.lastTeleportFrom=null,this.lastTeleportTo=null,this.lastTeleport=Date.now(),this.startPosition=this.entity.getPosition().clone()},Teleportable.prototype.update=function(t){this.entity.getPosition().y<0&&this.teleport(this.lastTeleportFrom,this.lastTeleportTo)},Teleportable.prototype.teleport=function(t,e){var o;t&&Date.now()-this.lastTeleport<500||(this.lastTeleport=Date.now(),this.lastTeleportFrom=t,this.lastTeleportTo=e,e?(o=e.getPosition()).y+=.5:o=this.startPosition,this.entity.rigidbody.teleport(o),this.entity.rigidbody.linearVelocity=pc.Vec3.ZERO,this.entity.rigidbody.angularVelocity=pc.Vec3.ZERO)};var Teleport=pc.createScript("teleport");Teleport.attributes.add("target",{type:"entity",title:"Target Entity",description:"The target entity where we are going to teleport"}),Teleport.prototype.initialize=function(){this.target&&this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},Teleport.prototype.onTriggerEnter=function(t){t.script.teleportable&&t.script.teleportable.teleport(this.entity,this.target)};var LookCamera=pc.createScript("lookCamera");LookCamera.attributes.add("mouseLookSensitivity",{type:"number",default:0,title:"Mouse Look Sensitivity"}),LookCamera.attributes.add("touchLookSensitivity",{type:"number",default:0,title:"Touch Look Sensitivity"}),LookCamera.attributes.add("snappinessFactor",{type:"number",default:.1,title:"Snappiness Factor",description:"Lower is faster"}),LookCamera.prototype.initialize=function(){this._tempQuat1=new pc.Quat,this._tempQuat2=new pc.Quat,this._tempVec3_1=new pc.Vec3;var t=this.entity.getLocalRotation();this.ey=this.getYaw(t)*pc.math.RAD_TO_DEG,this.ex=this.getPitch(t,this.ey)*pc.math.RAD_TO_DEG,this.targetEx=this.ex,this.targetEy=this.ey,this.moved=!1,this.app.mouse.disableContextMenu(),this.lastTouchPosition=new pc.Vec2,this.addEventCallbacks()},LookCamera.prototype.addEventCallbacks=function(){this.app.mouse&&this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))},LookCamera.prototype.update=function(t){var e=1;this.snappinessFactor>0&&(e=t/this.snappinessFactor),this.ex=pc.math.lerp(this.ex,this.targetEx,e),this.ey=pc.math.lerp(this.ey,this.targetEy,e),this.entity.setLocalEulerAngles(this.ex,this.ey,0)},LookCamera.prototype.moveCamera=function(t,e,o){this.moved?(this.targetEx-=e*o,this.targetEx=pc.math.clamp(this.targetEx,-90,90),this.targetEy-=t*o):this.moved=!0},LookCamera.prototype.onMouseMove=function(t){this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT)&&this.moveCamera(t.dx,t.dy,this.mouseLookSensitivity)},LookCamera.prototype.onTouchStart=function(t){var e=t.touches[0];this.lastTouchPosition.set(e.x,e.y)},LookCamera.prototype.onTouchMove=function(t){var e=t.touches[0];this.moveCamera(-(e.x-this.lastTouchPosition.x),-(e.y-this.lastTouchPosition.y),this.touchLookSensitivity),this.lastTouchPosition.set(e.x,e.y)},LookCamera.prototype.getYaw=function(){var t=this.entity.forward.clone();return Math.atan2(-t.x,-t.z)},LookCamera.prototype.getPitch=function(t,e){var o=this._tempQuat1,i=this._tempQuat2;i.setFromEulerAngles(0,-e,0),o.mul2(i,t);var a=this._tempVec3_1;return o.transformVector(pc.Vec3.FORWARD,a),Math.atan2(a.y,-a.z)};